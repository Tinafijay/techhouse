<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover" />
    <title>UltraShare Pro - Tech House</title>
    <script src="https://unpkg.com/peerjs@1.4.7/dist/peerjs.min.js"></script>
    <style>
        :root { --primary: #007bff; --bg: #f8fafc; --card: #ffffff; --text: #0f172a; }
        [data-theme="dark"] { --bg: #0f172a; --card: #1e293b; --text: #f8fafc; }
        
        body { font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 20px; transition: 0.3s; }
        .container { max-width: 500px; margin: auto; background: var(--card); padding: 30px; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        .id-badge { background: #e2e8f0; padding: 10px; border-radius: 8px; font-weight: bold; font-size: 1.2rem; margin: 10px 0; color: var(--primary); }
        input { width: 100%; padding: 12px; margin: 10px 0; border: 2px solid #e2e8f0; border-radius: 10px; box-sizing: border-box; font-size: 1rem; }
        button { width: 100%; padding: 15px; background: var(--primary); color: white; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; margin-top: 10px; }
        .file-section { border: 2px dashed var(--primary); padding: 20px; border-radius: 15px; margin-top: 20px; }
        #status { font-weight: bold; margin-bottom: 15px; color: #64748b; }
    </style>
</head>
<body>

<div class="container">
    <h1 style="text-align:center">ðŸš€ UltraShare Pro</h1>
    <div id="status">ðŸ“¡ System: Initializing...</div>

    <div style="text-align:center">
        <small>Your 6-Digit Share Code:</small>
        <div id="my-id" class="id-badge">------</div>
    </div>

    <input type="number" id="peer-id-input" placeholder="Enter Partner's 6-Digit Code">
    <button id="connect-btn">ðŸ”— Connect to Partner</button>

    <div class="file-section">
        <h3>ðŸ“¤ Share Files</h3>
        <input type="file" id="file-input">
        <button id="send-btn">Send to Partner</button>
        <p id="transfer-info" style="font-size: 0.8rem; margin-top: 10px;"></p>
    </div>
</div>

<script>
    // Sync Dark Mode with Tech House
    if (localStorage.getItem('theme') === 'dark') document.documentElement.setAttribute('data-theme', 'dark');

    let peer;
    let conn;
    
    // Generate a random 6-digit number
    const shortId = Math.floor(100000 + Math.random() * 900000).toString();
    
    // PeerJS setup with the 6-digit ID
    peer = new Peer('TH-' + shortId); 

    peer.on('open', (id) => {
        document.getElementById('my-id').innerText = shortId;
        document.getElementById('status').innerText = "ðŸ“¡ System: Ready to share";
    });

    // Handle Incoming
    peer.on('connection', (incoming) => {
        conn = incoming;
        setupEvents();
    });

    // Connect logic
    document.getElementById('connect-btn').onclick = () => {
        const targetId = document.getElementById('peer-id-input').value;
        if (targetId.length !== 6) return alert("Please enter a 6-digit code!");
        conn = peer.connect('TH-' + targetId);
        setupEvents();
    };

    function setupEvents() {
        conn.on('open', () => {
            document.getElementById('status').innerText = "âœ… Connected to Partner!";
            document.getElementById('status').style.color = "#10b981";
        });

        conn.on('data', (data) => {
            if (data.file) {
                const blob = new Blob([data.file], { type: data.mime });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = data.name;
                a.click();
                document.getElementById('transfer-info').innerText = "âœ… Received: " + data.name;
            }
        });
    }

    // Send logic optimized for mobile Chrome
    document.getElementById('send-btn').onclick = () => {
        const file = document.getElementById('file-input').files[0];
        if (!file || !conn || !conn.open) return alert("Select a file and ensure you are connected!");

        document.getElementById('transfer-info').innerText = "â³ Sending " + file.name + "...";

        const reader = new FileReader();
        reader.onload = (e) => {
            conn.send({
                file: e.target.result,
                name: file.name,
                mime: file.type
            });
            document.getElementById('transfer-info').innerText = "âœ… Sent successfully!";
        };
        reader.readAsArrayBuffer(file);
    };
</script>
</body>
</html>